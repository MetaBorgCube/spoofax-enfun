Module("lib/index-library.generated",[Imports([Import("libstratego-lib"),Import("lib/editor-common.generated")]),Signature([Constructors([OpDecl("DefData",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")])),ConstType(SortNoArgs("DefDataType")),ConstType(SortNoArgs("Term"))],ConstType(SortNoArgs("Summary")))),OpDecl("Namespace",ConstType(SortNoArgs("UriPart"))),OpDecl("Unresolved",FunType([ConstType(SortNoArgs("Namespace"))],ConstType(SortNoArgs("UriPart")))),OpDecl("INTERNAL_ERROR",ConstType(SortNoArgs("UriPart"))),OpDecl("Timestamp",ConstType(SortNoArgs("UriPart"))),OpDecl("String",ConstType(SortNoArgs("UriPart"))),OpDecl("Anon",FunType([ConstType(SortNoArgs("Int"))],ConstType(SortNoArgs("UriPart")))),OpDecl("Anon",ConstType(SortNoArgs("UriPart"))),OpDecl("FileEntries",FunType([ConstType(SortNoArgs("Term")),ConstType(SortNoArgs("Term"))],ConstType(SortNoArgs("Term")))),OpDecl("Global",ConstType(SortNoArgs("Namespace"))),OpDecl("Global",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")]))],ConstType(SortNoArgs("Summary")))),OpDecl("Global",FunType([ConstType(Sort("List",[SortNoArgs("UriPart")])),ConstType(Sort("List",[SortNoArgs("Summary")]))],ConstType(SortNoArgs("Summary")))),OpDecl("None",ConstType(SortNoArgs("Namespace")))])]),Rules([SDefT("index-setup",[],[DefaultVarDec("language"),DefaultVarDec("project-paths")],Seq(Call(SVar("obsolete"),[Build(NoAnnoList(Str("\"index-setup(|language, project-paths); use index-setup(|language, project-paths, current-file)\"")))]),CallT(SVar("index-setup"),[],[Var("language"),Var("project-paths"),NoAnnoList(Str("\".\""))]))),SDefT("index-setup",[],[DefaultVarDec("language"),DefaultVarDec("project-paths"),DefaultVarDec("current-file")],Prim("\"LANG_index_setup\"",[Var("language"),Var("project-paths"),Var("current-file")])),SDefNoArgs("index-set-current-file",Prim("\"LANG_index_set_current_file\"",[RootApp(Id)])),SDefT("index-add",[],[DefaultVarDec("file")],Prim("\"LANG_index_add\"",[RootApp(Id),Var("file")])),SDefT("index-add-all",[],[DefaultVarDec("file")],Call(SVar("list-loop"),[With(CallT(SVar("index-add"),[],[Var("file")]))])),SDefT("index-remove",[],[DefaultVarDec("file")],Prim("\"LANG_index_remove\"",[RootApp(Id),Var("file")])),SDefT("index-remove-all",[],[DefaultVarDec("file")],Call(SVar("list-loop"),[With(CallT(SVar("index-remove"),[],[Var("file")]))])),SDefNoArgs("index-clear-file",Prim("\"LANG_index_clear_file\"",[RootApp(Id)])),SDefNoArgs("index-clear",PrimNoArgs("\"LANG_index_clear_all\"")),SDefNoArgs("index-reload",PrimNoArgs("\"LANG_index_reload\"")),SDefNoArgs("index-commit",PrimNoArgs("\"LANG_index_commit\"")),SDefNoArgs("index-start-transaction",PrimNoArgs("\"LANG_index_start_transaction\"")),SDefNoArgs("index-end-transaction",PrimNoArgs("\"LANG_index_end_transaction\"")),SDef("index-transaction",[DefaultVarDec("s")],Seq(PrimNoArgs("\"LANG_index_start_transaction\""),Seq(Call(SVar("try"),[CallNoArgs(SVar("s"))]),PrimNoArgs("\"LANG_index_end_transaction\""))))]),Rules([SDefNoArgs("index-get-current-file",PrimNoArgs("\"LANG_index_get_current_file\"")),SDefNoArgs("index-get-all-files",PrimNoArgs("\"LANG_index_all_files\"")),RDefNoArgs("index-get-all-in-file",Rule(Var("filepath"),Var("entries"),[WithClause(Assign(Var("entries"),RootApp(Prim("\"LANG_index_get_all_in_file\"",[Var("filepath")]))))])),RDefT("index-get-all-in-file",[],[DefaultVarDec("namespace")],Rule(Var("filepath"),Var("entries"),[WithClause(Seq(Assign(Var("entries"),RootApp(Prim("\"LANG_index_get_all_in_file\"",[Var("filepath")]))),Call(SVar("filter"),[Where(AM(CallNoArgs(SVar("index-uri")),NoAnnoList(ListTail([Var("namespace")],Wld))))])))])),RDefNoArgs("index-get-file-revision",RuleNoCond(Var("file"),RootApp(Prim("\"LANG_index_get_file_revision\"",[Var("file")])))),RDefNoArgs("index-get-files-of",RuleNoCond(Var("template"),RootApp(Prim("\"LANG_index_get_files_of\"",[Var("template")])))),RDefNoArgs("indexlib-get-all",RuleNoCond(Var("template"),RootApp(Prim("\"LANG_index_get\"",[Var("template")])))),RDefNoArgs("indexlib-get-all-values",RuleNoCond(Var("template"),App(Call(SVar("map"),[CallNoArgs(SVar("index-value"))]),App(CallNoArgs(SVar("indexlib-get-all")),Var("template"))))),RDefNoArgs("indexlib-get",RuleNoCond(Var("template"),App(Match(NoAnnoList(ListTail([RootApp(Id)],Wld))),App(CallNoArgs(SVar("indexlib-get-all")),Var("template"))))),RDefNoArgs("indexlib-get-value",RuleNoCond(Var("template"),App(CallNoArgs(SVar("index-value")),App(Match(NoAnnoList(ListTail([RootApp(Id)],Wld))),App(CallNoArgs(SVar("indexlib-get-all")),Var("template"))))))]),Rules([SDefNoArgs("index-globals-path",Build(NoAnnoList(Str("\"/.internal/globals\"")))),RDefNoArgs("index-globals-uri",Rule(Var("names"),Var("uri"),[WithClause(CondChoice(CallNoArgs(SVar("is-list")),Assign(Var("uri"),App(CallNoArgs(SVar("concat")),NoAnnoList(List([NoAnnoList(List([NoAnnoList(Op("Global",[]))])),Var("names"),NoAnnoList(List([NoAnnoList(Str("\"globals\"")),NoAnnoList(Str("\".internal\""))]))])))),Assign(Var("uri"),NoAnnoList(List([NoAnnoList(Op("Global",[])),Var("names"),NoAnnoList(Str("\"global\"")),NoAnnoList(Str("\".internal\""))])))))])),RDefT("index-get-global",[],[DefaultVarDec("name")],Rule(Wld,Var("value"),Assign(Var("value"),App(CallNoArgs(SVar("indexlib-get-value")),NoAnnoList(Op("Global",[App(CallNoArgs(SVar("index-globals-uri")),Var("name")),NoAnnoList(Tuple([]))])))))),RDefT("index-get-all-globals",[],[DefaultVarDec("name")],Rule(Wld,Var("values"),[WithClause(Assign(Var("values"),App(CallNoArgs(SVar("indexlib-get-all-values")),NoAnnoList(Op("Global",[App(CallNoArgs(SVar("index-globals-uri")),Var("name")),NoAnnoList(Tuple([]))])))))])),RDefT("index-add-global",[],[DefaultVarDec("name")],Rule(Var("value"),RootApp(Id),[WithClause(BA(CallT(SVar("index-add"),[],[RootApp(CallNoArgs(SVar("index-globals-path")))]),NoAnnoList(Op("Global",[App(CallNoArgs(SVar("index-globals-uri")),Var("name")),Var("value")]))))])),RDefT("index-set-global",[],[DefaultVarDec("name")],Rule(Var("value"),RootApp(Id),[WithClause(Seq(CallT(SVar("index-clear-global"),[],[Var("name")]),BA(CallT(SVar("index-add-global"),[],[Var("name")]),Var("value"))))])),RDefT("index-clear-global",[],[DefaultVarDec("name")],Rule(Wld,RootApp(Id),[WithClause(BA(CallT(SVar("index-remove"),[],[RootApp(CallNoArgs(SVar("index-globals-path")))]),NoAnnoList(Op("Global",[App(CallNoArgs(SVar("index-globals-uri")),Var("name")),NoAnnoList(Tuple([]))]))))])),RDefNoArgs("index-boolean-globals-uri",Rule(Var("names"),Var("uri"),[WithClause(CondChoice(CallNoArgs(SVar("is-list")),Assign(Var("uri"),App(CallNoArgs(SVar("concat")),NoAnnoList(List([NoAnnoList(List([NoAnnoList(Op("Global",[]))])),Var("names"),NoAnnoList(List([NoAnnoList(Str("\"boolean\"")),NoAnnoList(Str("\"globals\"")),NoAnnoList(Str("\".internal\""))]))])))),Assign(Var("uri"),NoAnnoList(List([NoAnnoList(Op("Global",[])),Var("names"),NoAnnoList(Str("\"boolean\"")),NoAnnoList(Str("\"global\"")),NoAnnoList(Str("\".internal\""))])))))])),RDefT("index-enable-global",[],[DefaultVarDec("name")],Rule(Wld,RootApp(Id),[WithClause(BA(CallT(SVar("index-add"),[],[RootApp(CallNoArgs(SVar("index-globals-path")))]),NoAnnoList(Op("Global",[App(CallNoArgs(SVar("index-boolean-globals-uri")),Var("name"))]))))])),RDefT("index-disable-global",[],[DefaultVarDec("name")],Rule(Wld,RootApp(Id),[WithClause(BA(CallT(SVar("index-remove"),[],[RootApp(CallNoArgs(SVar("index-globals-path")))]),NoAnnoList(Op("Global",[App(CallNoArgs(SVar("index-boolean-globals-uri")),Var("name"))]))))])),RDefT("index-is-global-enabled",[],[DefaultVarDec("name")],Rule(Wld,RootApp(Id),BA(CallNoArgs(SVar("indexlib-get")),NoAnnoList(Op("Global",[App(CallNoArgs(SVar("index-boolean-globals-uri")),Var("name"))])))))]),Rules([SDefNoArgs("index-uri",LChoice(CallNoArgs(SVar("index-uri-impl")),CallNoArgs(SVar("index-uri-generic")))),SDefNoArgs("index-uri-namespace",Match(NoAnnoList(ListTail([RootApp(Id)],Wld)))),SDefNoArgs("index-uri-path",Match(NoAnnoList(ListTail([Wld],RootApp(Id))))),SDefNoArgs("index-uri-name",Match(NoAnnoList(ListTail([Wld],NoAnnoList(ListTail([RootApp(Id)],Wld)))))),SDefNoArgs("index-uri-parent",Seq(Match(NoAnnoList(ListTail([Var("ns")],NoAnnoList(ListTail([Wld],RootApp(Id)))))),Build(NoAnnoList(ListTail([Var("ns")],RootApp(Id)))))),SDefNoArgs("index-value",LChoice(CallNoArgs(SVar("index-value-impl")),CallNoArgs(SVar("index-value-generic")))),SDefNoArgs("index-is-fake-file",CallT(SVar("string-starts-with"),[],[NoAnnoList(Str("\"/.internal\""))])),RDefNoArgs("index-uri-eq",Rule(NoAnnoList(Tuple([Var("u1"),Var("u2")])),RootApp(Id),Seq(Assign(Var("u1'"),App(CallNoArgs(SVar("index-uri-unwrap")),Var("u1"))),Seq(Assign(Var("u2'"),App(CallNoArgs(SVar("index-uri-unwrap")),Var("u2"))),LChoice(BA(CallNoArgs(SVar("eq")),NoAnnoList(Tuple([Var("u1'"),Var("u2'")]))),BA(CallNoArgs(SVar("eq")),NoAnnoList(Tuple([App(Call(SVar("remove-all"),[Match(NoAnnoList(Op("Anon",[Wld])))]),Var("u1'")),App(Call(SVar("remove-all"),[Match(NoAnnoList(Op("Anon",[Wld])))]),Var("u2'"))])))))))),RDefNoArgs("index-find-key",Rule(Var("x"),Var("key"),Assign(Var("key"),App(Call(SVar("collect-one"),[Match(AnnoList(Wld,[Wld]))]),Var("x"))))),RDefNoArgs("index-path-to-string",Rule(Var("path"),Var("str"),[WithClause(Assign(Var("str"),App(Seq(Call(SVar("take-until"),[Match(NoAnnoList(Op("Anon",[Wld])))]),Seq(CallNoArgs(SVar("reverse")),Seq(CallT(SVar("separate-by"),[],[NoAnnoList(Str("\".\""))]),CallNoArgs(SVar("concat-strings"))))),Var("path"))))])),RDefNoArgs("index-uri-to-string",Rule(NoAnnoList(ListTail([Var("ns")],Var("path"))),App(CallNoArgs(SVar("concat-strings")),NoAnnoList(List([Var("nsStr"),NoAnnoList(Str("\"://\"")),Var("pathStr")]))),[WithClause(Seq(Assign(Var("pathStr"),App(CallNoArgs(SVar("index-path-to-string")),Var("path"))),Assign(Var("nsStr"),App(Match(NoAnnoList(Explode(RootApp(Id),Wld))),Var("ns")))))])),RDefNoArgs("index-file-to-string",Rule(Var("file"),Var("file"),Not(BA(CallNoArgs(SVar("is-tuple")),Var("file"))))),RDefNoArgs("index-file-to-string",RuleNoCond(NoAnnoList(Tuple([Var("file"),NoAnnoList(List([]))])),Var("file"))),RDefNoArgs("index-file-to-string",Rule(NoAnnoList(Tuple([Var("file"),Var("subfile")])),App(CallNoArgs(SVar("concat-strings")),NoAnnoList(List([Var("file"),NoAnnoList(Str("\"@\"")),App(CallNoArgs(SVar("index-uri-to-string")),Var("subfile"))]))),Not(Assign(NoAnnoList(List([])),Var("subfile"))))),RDefNoArgs("index-file-to-uri",Rule(Var("file"),NoAnnoList(List([NoAnnoList(Op("None",[])),Var("file")])),Not(BA(CallNoArgs(SVar("is-tuple")),Var("file"))))),RDefNoArgs("index-file-to-uri",RuleNoCond(NoAnnoList(Tuple([Var("file"),NoAnnoList(List([]))])),NoAnnoList(List([NoAnnoList(Op("None",[])),Var("file")])))),RDefNoArgs("index-file-to-uri",Rule(NoAnnoList(Tuple([Var("file"),Var("subfile")])),App(CallNoArgs(SVar("conc")),NoAnnoList(Tuple([NoAnnoList(List([Var("file")])),Var("subfile")]))),Not(Assign(NoAnnoList(List([])),Var("subfile")))))]),Rules([RDefNoArgs("index-uri-impl",RuleNoCond(NoAnnoList(ListTail([Wld],Wld)),RootApp(Id))),RDefNoArgs("index-uri-impl",RuleNoCond(NoAnnoList(Op("DefData",[Var("uri"),Wld,Wld])),Var("uri"))),RDefNoArgs("index-uri-generic",RuleNoCond(Var("term"),App(Match(NoAnnoList(Explode(Wld,RootApp(Match(NoAnnoList(ListTail([RootApp(Id)],Wld))))))),Var("term")))),RDefNoArgs("index-value-impl",RuleNoCond(NoAnnoList(Op("DefData",[Wld,Wld,Var("value")])),Var("value"))),RDefNoArgs("index-value-generic",RuleNoCond(Var("term"),App(Match(NoAnnoList(Explode(Wld,RootApp(Match(NoAnnoList(ListTail([Wld,RootApp(Id)],Wld))))))),Var("term"))))]),Rules([SDefNoArgs("index-namespace-unwrap",LChoice(LRule(RuleNoCond(NoAnnoList(Op("Unresolved",[Var("n")])),Var("n"))),Id)),SDefNoArgs("index-uri-unwrap",LChoice(LRule(RuleNoCond(NoAnnoList(ListTail([Var("ns")],Var("xs"))),NoAnnoList(ListTail([App(CallNoArgs(SVar("index-namespace-unwrap")),Var("ns"))],Var("xs"))))),Id))])])