Module("types",[Imports([Import("include/Enfun"),Import("enfun"),Import("names")]),Imports([Import("lib/analysis-library.generated"),Import("lib/analysis-library-internal.generated"),Import("lib/index-library.generated"),Import("lib/nbl-library.generated")]),Overlays([OverlayNoArgs("TypeVoid",NoAnnoList(Op("Type",[AnnoList(Str("\"Void\""),[NoAnnoList(List([NoAnnoList(Op("Type",[])),NoAnnoList(Str("\"Void\""))]))]),NoAnnoList(List([]))]))),OverlayNoArgs("TypeInt",NoAnnoList(Op("Type",[AnnoList(Str("\"Int\""),[NoAnnoList(List([NoAnnoList(Op("Type",[])),NoAnnoList(Str("\"Int\""))]))]),NoAnnoList(List([]))]))),OverlayNoArgs("TypeString",NoAnnoList(Op("Type",[AnnoList(Str("\"String\""),[NoAnnoList(List([NoAnnoList(Op("Type",[])),NoAnnoList(Str("\"String\""))]))]),NoAnnoList(List([]))]))),OverlayNoArgs("TypeBool",NoAnnoList(Op("Type",[AnnoList(Str("\"Bool\""),[NoAnnoList(List([NoAnnoList(Op("Type",[])),NoAnnoList(Str("\"Bool\""))]))]),NoAnnoList(List([]))])))]),Rules([RDefNoArgs("type-of",Rule(Var("xs"),App(Call(SVar("map"),[CallNoArgs(SVar("type-of"))]),Var("xs")),BA(CallNoArgs(SVar("is-list")),Var("xs")))),SDefNoArgs("lookup-type",Seq(CallNoArgs(SVar("index-lookup")),CallT(SVar("index-get-data"),[],[NoAnnoList(Op("Type",[]))])))]),Rules([RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("New",[Var("t")])),Var("t"))),RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("None",[])),NoAnnoList(List([])))),RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("Some",[Var("x")])),App(CallNoArgs(SVar("type-of")),Var("x")))),RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("TypeParams",[Var("x")])),App(CallNoArgs(SVar("type-of")),Var("x")))),RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("TypeParam",[Var("x")])),NoAnnoList(Op("Type",[Var("x"),NoAnnoList(List([]))]))))]),Rules([RDefNoArgs("type-of",Rule(NoAnnoList(Op("PropAccess",[Var("e"),Var("x")])),Var("t"),AM(BA(CallNoArgs(SVar("lookup-type")),Var("x")),Var("t")))),RDefT("nam-annotate-names",[],[DefaultVarDec("paths__"),DefaultVarDec("path__")],RuleNoCond(NoAnnoList(Op("This",[])),AnnoList(Op("This",[]),[NoAnnoList(ListTail([NoAnnoList(Op("Type",[]))],App(CallNoArgs(SVar("lookup-index-path")),NoAnnoList(Tuple([NoAnnoList(Op("Property",[])),Var("paths__")])))))]))),RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("This",[])),RootApp(Seq(CallNoArgs(SVar("index-uri")),CallT(SVar("index-get-data"),[],[NoAnnoList(Op("Type",[]))])))))]),Rules([RDefNoArgs("type-of",Rule(NoAnnoList(Op("MethCall",[Var("e"),Var("x"),Var(ListVar("e*"))])),Var("t"),AM(BA(CallNoArgs(SVar("lookup-type")),Var("x")),NoAnnoList(Tuple([Var(ListVar("t*")),Var("t")]))))),RDefNoArgs("type-of",Rule(NoAnnoList(Op("ThisCall",[Var("f"),Var(ListVar("e*"))])),Var("t"),AM(BA(CallNoArgs(SVar("lookup-type")),Var("f")),NoAnnoList(Tuple([Var(ListVar("t*")),Var("t")]))))),RDefT("nam-annotate-names",[],[DefaultVarDec("paths__"),DefaultVarDec("path__")],RuleNoCond(NoAnnoList(Op("Return",[Var("e")])),AnnoList(Op("Return",[Var("e")]),[NoAnnoList(ListTail([NoAnnoList(Op("Function",[]))],App(CallNoArgs(SVar("lookup-index-path")),NoAnnoList(Tuple([NoAnnoList(Op("Variable",[])),Var("paths__")])))))]))),RDefNoArgs("type-of",Rule(NoAnnoList(Op("Return",[Var("e")])),Var("t"),Seq(CallNoArgs(SVar("index-uri")),AM(CallT(SVar("index-get-data"),[],[NoAnnoList(Op("Type",[]))]),NoAnnoList(Tuple([Wld,Var("t")]))))))]),Rules([RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("Var",[Var("x")])),App(CallNoArgs(SVar("lookup-type")),Var("x"))))]),Rules([RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("True",[])),NoAnnoList(Op("TypeBool",[])))),RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("False",[])),NoAnnoList(Op("TypeBool",[])))),RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("Int",[Var("i")])),NoAnnoList(Op("TypeInt",[])))),RDefNoArgs("type-of",RuleNoCond(NoAnnoList(Op("String",[Var("x")])),NoAnnoList(Op("TypeString",[]))))]),Signature([Constructors([OpDecl("Parent",ConstType(SortNoArgs("DefDataKind")))])]),Rules([RDefT("adjust-index-def-data",[DefaultVarDec("store")],[DefaultVarDec("ns"),DefaultVarDec("path")],RuleNoCond(NoAnnoList(Op("Entity",[Var("c"),Wld,NoAnnoList(Op("Some",[NoAnnoList(Op("Extends",[Var("c'")]))])),Wld])),App(CallNoArgs(SVar("store")),NoAnnoList(Op("DefData",[NoAnnoList(ListTail([Var("ns")],Var("path"))),NoAnnoList(Op("Parent",[])),Var("c'")]))))),RDefNoArgs("parent",Rule(Var("class-name"),Var("parent-name"),Seq(Assign(Var("class-def"),App(CallNoArgs(SVar("index-lookup")),Var("class-name"))),Assign(Var("parent-name"),App(CallT(SVar("index-get-data"),[],[NoAnnoList(Op("Parent",[]))]),Var("class-def"))))))]),Rules([SDefNoArgs("ancestors",CallT(SVar("ancestors"),[],[NoAnnoList(List([]))])),RDefT("ancestors",[],[DefaultVarDec("as")],Rule(Var("class-name"),Var("as'"),CondChoice(Seq(BA(Not(CallNoArgs(SVar("elem"))),NoAnnoList(Tuple([Var("class-name"),Var("as")]))),Assign(Var("a"),App(CallNoArgs(SVar("parent")),Var("class-name")))),Assign(Var("as'"),App(CallT(SVar("ancestors"),[],[NoAnnoList(ListTail([Var("class-name")],Var("as")))]),Var("a"))),Assign(Var("as'"),NoAnnoList(ListTail([Var("class-name")],Var("as"))))))),RDefNoArgs("subtype",RuleNoCond(NoAnnoList(Tuple([Var("t"),Var("t")])),RootApp(Id))),RDefNoArgs("subtype",RuleNoCond(NoAnnoList(Tuple([NoAnnoList(Op("Type",[Var("t1"),Wld])),NoAnnoList(Op("Type",[Var("t2"),Wld]))])),App(CallNoArgs(SVar("elem")),NoAnnoList(Tuple([Var("t2"),App(CallNoArgs(SVar("ancestors")),Var("t1"))])))))])])